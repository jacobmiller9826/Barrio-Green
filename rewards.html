<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barrio Green â€“ Rewards</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app-container">
    <header>
      <h1 id="app-title">Barrio Green</h1>
      <p id="app-subtitle">Arizona Community Rewards</p>
      <div class="header-controls">
        <button id="lang-toggle" aria-label="Toggle Language">ES</button>
        <button id="mode-toggle" aria-label="Toggle Dark Mode">ðŸŒ™</button>
      </div>
    </header>

    <nav>
      <a href="dashboard.html"><button>Dashboard</button></a>
      <a href="exchange.html"><button>Exchange Credits</button></a>
      <a href="rewards.html"><button disabled style="opacity: 0.6; cursor: default;">Rewards</button></a>
      <a href="admin.html"><button>Admin</button></a>
    </nav>

    <section class="card" role="region" aria-labelledby="rewards-title">
      <h2 id="rewards-title">Rewards Catalog</h2>
      <div class="reward-item card" style="margin-bottom: 1rem;">
        <h3>Baseball Tickets</h3>
        <p>Cost: 50 TUC</p>
        <button class="redeem-btn" data-cost="50">Redeem</button>
      </div>
      <div class="reward-item card" style="margin-bottom: 1rem;">
        <h3>Farmers Market Discount</h3>
        <p>Cost: 30 TUC</p>
        <button class="redeem-btn" data-cost="30">Redeem</button>
      </div>
      <p id="redeem-status" aria-live="polite" style="font-weight: bold;"></p>
    </section>

    <footer>
      <p>&copy; 2025 Barrio Green â€“ Made in Arizona ðŸŒµ</p>
    </footer>
  </div>
  <script type="module" src="app.js"></script>
  <script>
    // Redeem logic:
    import { createThirdwebClient, getContract, defineChain } from "https://esm.sh/@thirdweb-dev/sdk@0.16.1/evm";

    document.addEventListener("DOMContentLoaded", () => {
      const clientId = "05a0325af41e925b0e2ff52a16efa407";
      const contractAddress = "0xC52a002023ABA42B4490f625Df6434fc26E425c8";
      const chain = defineChain("sepolia");
      const client = createThirdwebClient({ clientId });

      const redeemStatus = document.getElementById("redeem-status");

      async function redeemTokens(cost) {
        try {
          redeemStatus.textContent = "Redeeming...";
          const contract = await getContract({ client, address: contractAddress, chain });
          const wallet = createLocalWallet();
          await wallet.connect();
          const address = await wallet.getAddress();

          // Burn tokens to simulate redemption
          await contract.erc20.burnFrom(address, cost.toString());
          redeemStatus.textContent = `Redeemed reward for ${cost} TUC!`;
        } catch (err) {
          console.error(err);
          redeemStatus.textContent = "Error redeeming reward.";
        }
      }

      document.querySelectorAll(".redeem-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const cost = btn.getAttribute("data-cost");
          redeemTokens(cost);
        });
      });
    });
  </script>
</body>
</html>
